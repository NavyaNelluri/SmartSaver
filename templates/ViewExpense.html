<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>View Expenses</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-image: url("{{ url_for('static', filename='homeimg2.png') }}");
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #fff;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    table {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      border-collapse: collapse;
      margin-bottom: 20px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    th, td {
      border: 1px solid #dddddd;
      padding: 12px;
      text-align: left;
      transition: all 0.2s ease-in-out;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }
    .edit-form {
      display: none;
      background: rgba(255, 255, 255, 0.9);
    }
    .edit-form input, .edit-form select {
      width: calc(100% - 20px);
      padding: 10px;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
    .edit-form button {
      background-color: #4CAF50;
      color: white;
      padding: 10px;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }
    .edit-form button:hover {
      background-color: #45a049;
    }
    .edit-button {
      background-color: #FFA500;
      color: white;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }
    .edit-button:hover {
      background-color: #FF8C00;
    }
    .alert {
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 4px;
      color: white;
      display: inline-block;
      width: 100%;
      box-sizing: border-box;
    }
    .alert-success {
      background-color: #4CAF50;
    }
    .alert-error {
      background-color: #f44336;
    }
    .alert-warning {
      background-color: #ff9800;
    }
    .alert-info {
      background-color: #2196F3;
    }
  </style>
</head>
<body>
  <h1>View Expenses</h1>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% set latest_message = messages[-1] %}
      <div class="alert alert-{{ latest_message[0] }}">
        {{ latest_message[1] }}
      </div>
      <script>
        setTimeout(function() {
          document.querySelector('.alert').style.display = 'none';
        }, 5000);
      </script>
    {% endif %}
  {% endwith %}
  <table>
    <thead>
      <tr>
        <th>Expense Type</th>
        <th>Frequency</th>
        <th>Amount</th>
        <th>Notes</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for expense in expenses %}
      <tr>
        <td>{{ expense[0] }}</td>
        <td>{{ expense[1] }}</td>
        <td>{{ expense[2] }}</td>
        <td>{{ expense[3] }}</td>
        <td>
          <button class="edit-button" onclick="toggleEditForm('{{ expense[4] }}')">Edit</button>
        </td>
      </tr>
      <tr class="edit-form" id="editForm{{ expense[4] }}">
        <td colspan="5">
          <form method="POST" action="{{ url_for('edit_expense', expense_id=expense[4]) }}">
            <input type="hidden" name="expense_id" value="{{ expense[4] }}">
            <label for="frequency">Frequency:</label>
            <select name="frequency" id="frequency">
              <option value="weekly" {% if expense[1] == 'weekly' %}selected{% endif %}>Weekly</option>
              <option value="bi-weekly" {% if expense[1] == 'bi-weekly' %}selected{% endif %}>Bi-Weekly</option>
              <option value="monthly" {% if expense[1] == 'monthly' %}selected{% endif %}>Monthly</option>
              <option value="OneTimeExpense" {% if expense[1] == 'OneTimeExpense' %}selected{% endif %}>One Time Expense</option>
            </select>
            <label for="expense_type">Expense Type:</label>
            <select name="expense_type" id="expense_type">
              <option value="Groceries" {% if expense[0] == 'Groceries' %}selected{% endif %}>Groceries</option>
              <option value="Vehicle Maintenance" {% if expense[0] == 'Vehicle Maintenance' %}selected{% endif %}>Vehicle Maintenance</option>
              <option value="Housing" {% if expense[0] == 'Housing' %}selected{% endif %}>Housing</option>
              <option value="Utilities" {% if expense[0] == 'Utilities' %}selected{% endif %}>Utilities</option>
              <option value="other" {% if expense[0] == 'other' %}selected{% endif %}>Other</option>
            </select>
            <label for="notes">Notes:</label>
            <input type="text" id="notes" name="Notes" value="{{ expense[3] }}" required>
            <label for="dollars">Amount:</label>
            <input type="number" id="dollars" name="dollars" value="{{ expense[2] }}" required>
            <button type="submit">Save</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <script>
    function toggleEditForm(expenseId) {
      var editForm = document.getElementById('editForm' + expenseId);
      if (editForm.style.display === "none" || editForm.style.display === "") {
        editForm.style.display = "table-row";
      } else {
        editForm.style.display = "none";
      }
    }
  </script>
</body>
</html>
